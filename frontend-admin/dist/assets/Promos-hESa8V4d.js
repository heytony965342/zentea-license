import{d as z,u as S,r as i,F as U,c as T,b as l,w as d,e as s,z as N,N as B,K as I,W as k,l as $,B as _,k as w,L as F,v,g as V,h as r,i as p,V as x,T as m,o as h}from"./index-g5hkaJ8F.js";const j=z({__name:"Promos",setup(L){const u=S(),f=i(!1),c=i([]),o=i(!1),y=i(!1),a=i({name:"",code:"",description:"",start_date:null,end_date:null,max_uses:null}),b=[{title:"ID",key:"id",width:60},{title:"活动名称",key:"name",width:150},{title:"活动码",key:"code",width:120,render:t=>v("code",t.code)},{title:"描述",key:"description",ellipsis:{tooltip:!0}},{title:"开始时间",key:"start_date",width:110,render:t=>new Date(t.start_date).toLocaleDateString("zh-CN")},{title:"结束时间",key:"end_date",width:110,render:t=>new Date(t.end_date).toLocaleDateString("zh-CN")},{title:"状态",key:"is_active",width:80,render:t=>{const e=new Date,n=new Date(t.start_date),C=new Date(t.end_date);return t.is_active?e<n?v(m,{type:"info",size:"small"},()=>"未开始"):e>C?v(m,{type:"error",size:"small"},()=>"已结束"):v(m,{type:"success",size:"small"},()=>"进行中"):v(m,{type:"default",size:"small"},()=>"已停用")}},{title:"使用次数",key:"uses",width:100,render:t=>`${t.current_uses}${t.max_uses?`/${t.max_uses}`:""}`}],g=async()=>{f.value=!0;try{const t=await k.get("/admin/promos");t.code===200&&(c.value=t.data||[])}catch{u.error("加载失败")}finally{f.value=!1}},D=async()=>{if(!a.value.name||!a.value.code){u.warning("请填写活动名称和活动码");return}if(!a.value.start_date||!a.value.end_date){u.warning("请选择活动时间");return}y.value=!0;try{const t={name:a.value.name,code:a.value.code,description:a.value.description,start_date:new Date(a.value.start_date).toISOString().split("T")[0],end_date:new Date(a.value.end_date).toISOString().split("T")[0],max_uses:a.value.max_uses||void 0},e=await k.post("/admin/promos",t);e.code===200?(u.success("创建成功"),o.value=!1,a.value={name:"",code:"",description:"",start_date:null,end_date:null,max_uses:null},g()):u.error(e.message||"创建失败")}catch(t){u.error(t.message||"创建失败")}finally{y.value=!1}};return U(g),(t,e)=>(h(),T("div",null,[l(s(N),{justify:"space-between",align:"center",style:{"margin-bottom":"24px"}},{default:d(()=>[e[10]||(e[10]=$("h2",{style:{margin:"0"}},"促销活动",-1)),l(s(_),{type:"primary",onClick:e[0]||(e[0]=n=>o.value=!0)},{default:d(()=>[...e[9]||(e[9]=[w("新建活动",-1)])]),_:1})]),_:1}),l(s(B),null,{default:d(()=>[l(s(F),{columns:b,data:c.value,loading:f.value,bordered:!1},null,8,["data","loading"])]),_:1}),l(s(I),{show:o.value,"onUpdate:show":e[8]||(e[8]=n=>o.value=n),title:"新建促销活动",preset:"card",style:{width:"500px"}},{footer:d(()=>[l(s(N),{justify:"end"},{default:d(()=>[l(s(_),{onClick:e[7]||(e[7]=n=>o.value=!1)},{default:d(()=>[...e[11]||(e[11]=[w("取消",-1)])]),_:1}),l(s(_),{type:"primary",loading:y.value,onClick:D},{default:d(()=>[...e[12]||(e[12]=[w("创建",-1)])]),_:1},8,["loading"])]),_:1})]),default:d(()=>[l(s(V),{"label-placement":"left","label-width":"80"},{default:d(()=>[l(s(r),{label:"活动名称"},{default:d(()=>[l(s(p),{value:a.value.name,"onUpdate:value":e[1]||(e[1]=n=>a.value.name=n),placeholder:"如：2025新年限免"},null,8,["value"])]),_:1}),l(s(r),{label:"活动码"},{default:d(()=>[l(s(p),{value:a.value.code,"onUpdate:value":e[2]||(e[2]=n=>a.value.code=n),placeholder:"如：NY2025"},null,8,["value"])]),_:1}),l(s(r),{label:"描述"},{default:d(()=>[l(s(p),{value:a.value.description,"onUpdate:value":e[3]||(e[3]=n=>a.value.description=n),type:"textarea",placeholder:"活动说明"},null,8,["value"])]),_:1}),l(s(r),{label:"开始时间"},{default:d(()=>[l(s(x),{value:a.value.start_date,"onUpdate:value":e[4]||(e[4]=n=>a.value.start_date=n),type:"date",style:{width:"100%"}},null,8,["value"])]),_:1}),l(s(r),{label:"结束时间"},{default:d(()=>[l(s(x),{value:a.value.end_date,"onUpdate:value":e[5]||(e[5]=n=>a.value.end_date=n),type:"date",style:{width:"100%"}},null,8,["value"])]),_:1}),l(s(r),{label:"限制次数"},{default:d(()=>[l(s(p),{value:a.value.max_uses,"onUpdate:value":e[6]||(e[6]=n=>a.value.max_uses=n),type:"number",placeholder:"不填则不限制"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["show"])]))}});export{j as default};
