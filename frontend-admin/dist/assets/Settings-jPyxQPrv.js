import{d as P,u as R,r as N,Z as b,F as T,c as I,b as l,w as r,e as t,N as M,_ as c,$ as V,a0 as m,a1 as w,k as y,g,h as p,a2 as j,z as S,a3 as E,a4 as O,i as _,B as k,a5 as C,a6 as D,o as A,a7 as G,m as h,C as f,Q as L}from"./index-BZbewaeb.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"settings-page"},H={style:{color:"#666","font-size":"12px","margin-top":"4px","margin-left":"24px"}},J={style:{color:"#999","font-size":"12px","margin-left":"24px"}},K=P({__name:"Settings",setup(W){const o=R(),v=N(!1),s=N(!1),d=b({server_mode:"local",server_url:"http://localhost:8001"}),U=[{value:"local",label:"本地调试环境",url:"http://localhost:8001",description:"用于本地开发和测试"},{value:"production",label:"生产环境",url:"https://sq.jinghuatea.com",description:"正式授权验证服务器"}],i=b({alipay_enabled:!1,alipay_app_id:"",alipay_private_key:"",alipay_public_key:"",alipay_notify_url:"",alipay_return_url:"",alipay_private_key_configured:!1,alipay_public_key_configured:!1,wechat_enabled:!1,wechat_app_id:"",wechat_mch_id:"",wechat_api_key:"",wechat_notify_url:"",wechat_api_key_configured:!1}),n=b({contact_phone:"",contact_email:"",contact_wechat:"",contact_qq:"",contact_address:"",contact_work_time:""}),q=async()=>{try{const u=await c.getAll("server");u.code===200&&u.data&&u.data.forEach(a=>{a.key==="server_mode"&&(d.server_mode=a.value||"local"),a.key==="server_url"&&(d.server_url=a.value||"http://localhost:8001")})}catch{}},F=async()=>{s.value=!0;try{const u=U.find(B=>B.value===d.server_mode),a=(u==null?void 0:u.url)||d.server_url,e=await c.update({server_mode:d.server_mode,server_url:a});e.code===200?(d.server_url=a,o.success("服务器设置保存成功")):o.error(e.message||"保存失败")}catch{o.error("保存失败")}finally{s.value=!1}},x=async()=>{v.value=!0;try{await q();const u=await c.getPayment();if(u.code===200&&u.data){const e=u.data;i.alipay_enabled=e.alipay_enabled==="true",i.alipay_app_id=e.alipay_app_id||"",i.alipay_private_key=e.alipay_private_key||"",i.alipay_public_key=e.alipay_public_key||"",i.alipay_notify_url=e.alipay_notify_url||"",i.alipay_return_url=e.alipay_return_url||"",i.alipay_private_key_configured=e.alipay_private_key_configured||!1,i.alipay_public_key_configured=e.alipay_public_key_configured||!1,i.wechat_enabled=e.wechat_enabled==="true",i.wechat_app_id=e.wechat_app_id||"",i.wechat_mch_id=e.wechat_mch_id||"",i.wechat_api_key=e.wechat_api_key||"",i.wechat_notify_url=e.wechat_notify_url||"",i.wechat_api_key_configured=e.wechat_api_key_configured||!1}const a=await c.getContact();a.code===200&&a.data&&Object.assign(n,a.data)}catch{o.error("加载设置失败")}finally{v.value=!1}},Q=async()=>{s.value=!0;try{const u={alipay_enabled:i.alipay_enabled?"true":"false",alipay_app_id:i.alipay_app_id,alipay_notify_url:i.alipay_notify_url,alipay_return_url:i.alipay_return_url,wechat_enabled:i.wechat_enabled?"true":"false",wechat_app_id:i.wechat_app_id,wechat_mch_id:i.wechat_mch_id,wechat_notify_url:i.wechat_notify_url};i.alipay_private_key&&i.alipay_private_key!=="******"&&(u.alipay_private_key=i.alipay_private_key),i.alipay_public_key&&i.alipay_public_key!=="******"&&(u.alipay_public_key=i.alipay_public_key),i.wechat_api_key&&i.wechat_api_key!=="******"&&(u.wechat_api_key=i.wechat_api_key);const a=await c.update(u);a.code===200?(o.success("支付设置保存成功"),x()):o.error(a.message||"保存失败")}catch{o.error("保存失败")}finally{s.value=!1}},z=async()=>{s.value=!0;try{const u=await c.update(n);u.code===200?o.success("客服联系方式保存成功"):o.error(u.message||"保存失败")}catch{o.error("保存失败")}finally{s.value=!1}};return T(()=>{x()}),(u,a)=>(A(),I("div",$,[l(t(M),{title:"系统设置"},{default:r(()=>[l(t(V),{type:"line",animated:""},{default:r(()=>[l(t(m),{name:"server",tab:"服务器模式"},{default:r(()=>[l(t(w),{type:"info",bordered:!1,style:{"margin-bottom":"24px"}},{default:r(()=>[...a[19]||(a[19]=[y(" 设置当前授权服务器的运行模式。本地调试模式用于开发测试，生产模式用于正式运营。 ",-1)])]),_:1}),l(t(g),{"label-placement":"left","label-width":"120px",disabled:v.value},{default:r(()=>[l(t(p),{label:"运行模式"},{default:r(()=>[l(t(j),{value:d.server_mode,"onUpdate:value":a[0]||(a[0]=e=>d.server_mode=e)},{default:r(()=>[l(t(S),{vertical:""},{default:r(()=>[(A(),I(E,null,O(U,e=>l(t(G),{key:e.value,value:e.value},{default:r(()=>[l(t(S),{align:"center"},{default:r(()=>[h("strong",null,f(e.label),1),l(t(L),{type:e.value==="production"?"success":"warning",size:"small"},{default:r(()=>[y(f(e.value==="production"?"正式":"调试"),1)]),_:2},1032,["type"])]),_:2},1024),h("div",H,f(e.description),1),h("div",J," 地址: "+f(e.url),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1}),l(t(p),{label:"当前地址"},{default:r(()=>[l(t(_),{value:d.server_url,"onUpdate:value":a[1]||(a[1]=e=>d.server_url=e),disabled:""},null,8,["value"])]),_:1}),l(t(p),{label:""},{default:r(()=>[l(t(k),{type:"primary",loading:s.value,onClick:F},{default:r(()=>[...a[20]||(a[20]=[y(" 保存服务器设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["disabled"])]),_:1}),l(t(m),{name:"payment",tab:"支付设置"},{default:r(()=>[l(t(w),{type:"info",bordered:!1,style:{"margin-bottom":"24px"}},{default:r(()=>[...a[21]||(a[21]=[y(" 配置在线支付接口后，用户可以在线购买授权。请确保填写正确的密钥信息。 ",-1)])]),_:1}),l(t(g),{"label-placement":"left","label-width":"140px",disabled:v.value},{default:r(()=>[l(t(C),{"title-placement":"left"},{default:r(()=>[...a[22]||(a[22]=[y("支付宝",-1)])]),_:1}),l(t(p),{label:"启用支付宝"},{default:r(()=>[l(t(D),{value:i.alipay_enabled,"onUpdate:value":a[2]||(a[2]=e=>i.alipay_enabled=e)},null,8,["value"])]),_:1}),l(t(p),{label:"应用ID (AppID)"},{default:r(()=>[l(t(_),{value:i.alipay_app_id,"onUpdate:value":a[3]||(a[3]=e=>i.alipay_app_id=e),placeholder:"支付宝开放平台应用ID"},null,8,["value"])]),_:1}),l(t(p),{label:"应用私钥"},{default:r(()=>[l(t(_),{value:i.alipay_private_key,"onUpdate:value":a[4]||(a[4]=e=>i.alipay_private_key=e),type:"textarea",rows:3,placeholder:i.alipay_private_key_configured?"已配置（不修改请留空）":"粘贴应用私钥"},null,8,["value","placeholder"])]),_:1}),l(t(p),{label:"支付宝公钥"},{default:r(()=>[l(t(_),{value:i.alipay_public_key,"onUpdate:value":a[5]||(a[5]=e=>i.alipay_public_key=e),type:"textarea",rows:3,placeholder:i.alipay_public_key_configured?"已配置（不修改请留空）":"粘贴支付宝公钥"},null,8,["value","placeholder"])]),_:1}),l(t(p),{label:"异步通知地址"},{default:r(()=>[l(t(_),{value:i.alipay_notify_url,"onUpdate:value":a[6]||(a[6]=e=>i.alipay_notify_url=e),placeholder:"https://your-domain.com/api/v1/payment/alipay/notify"},null,8,["value"])]),_:1}),l(t(p),{label:"同步跳转地址"},{default:r(()=>[l(t(_),{value:i.alipay_return_url,"onUpdate:value":a[7]||(a[7]=e=>i.alipay_return_url=e),placeholder:"https://your-domain.com/payment/success"},null,8,["value"])]),_:1}),l(t(C),{"title-placement":"left"},{default:r(()=>[...a[23]||(a[23]=[y("微信支付",-1)])]),_:1}),l(t(p),{label:"启用微信支付"},{default:r(()=>[l(t(D),{value:i.wechat_enabled,"onUpdate:value":a[8]||(a[8]=e=>i.wechat_enabled=e)},null,8,["value"])]),_:1}),l(t(p),{label:"应用ID (AppID)"},{default:r(()=>[l(t(_),{value:i.wechat_app_id,"onUpdate:value":a[9]||(a[9]=e=>i.wechat_app_id=e),placeholder:"微信公众号/小程序 AppID"},null,8,["value"])]),_:1}),l(t(p),{label:"商户号 (MchID)"},{default:r(()=>[l(t(_),{value:i.wechat_mch_id,"onUpdate:value":a[10]||(a[10]=e=>i.wechat_mch_id=e),placeholder:"微信支付商户号"},null,8,["value"])]),_:1}),l(t(p),{label:"API密钥"},{default:r(()=>[l(t(_),{value:i.wechat_api_key,"onUpdate:value":a[11]||(a[11]=e=>i.wechat_api_key=e),type:"password","show-password-on":"click",placeholder:i.wechat_api_key_configured?"已配置（不修改请留空）":"微信支付 API 密钥"},null,8,["value","placeholder"])]),_:1}),l(t(p),{label:"支付回调地址"},{default:r(()=>[l(t(_),{value:i.wechat_notify_url,"onUpdate:value":a[12]||(a[12]=e=>i.wechat_notify_url=e),placeholder:"https://your-domain.com/api/v1/payment/wechat/notify"},null,8,["value"])]),_:1}),l(t(p),{label:""},{default:r(()=>[l(t(k),{type:"primary",loading:s.value,onClick:Q},{default:r(()=>[...a[24]||(a[24]=[y(" 保存支付设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["disabled"])]),_:1}),l(t(m),{name:"contact",tab:"客服联系方式"},{default:r(()=>[l(t(w),{type:"info",bordered:!1,style:{"margin-bottom":"24px"}},{default:r(()=>[...a[25]||(a[25]=[y(" 设置客服联系方式，用户在购买授权或遇到问题时可以联系客服。 ",-1)])]),_:1}),l(t(g),{"label-placement":"left","label-width":"120px",disabled:v.value},{default:r(()=>[l(t(p),{label:"客服电话"},{default:r(()=>[l(t(_),{value:n.contact_phone,"onUpdate:value":a[13]||(a[13]=e=>n.contact_phone=e),placeholder:"如：400-123-4567"},null,8,["value"])]),_:1}),l(t(p),{label:"客服邮箱"},{default:r(()=>[l(t(_),{value:n.contact_email,"onUpdate:value":a[14]||(a[14]=e=>n.contact_email=e),placeholder:"如：support@zentea.com"},null,8,["value"])]),_:1}),l(t(p),{label:"客服微信"},{default:r(()=>[l(t(_),{value:n.contact_wechat,"onUpdate:value":a[15]||(a[15]=e=>n.contact_wechat=e),placeholder:"微信号或二维码图片链接"},null,8,["value"])]),_:1}),l(t(p),{label:"客服QQ"},{default:r(()=>[l(t(_),{value:n.contact_qq,"onUpdate:value":a[16]||(a[16]=e=>n.contact_qq=e),placeholder:"QQ号或QQ群号"},null,8,["value"])]),_:1}),l(t(p),{label:"公司地址"},{default:r(()=>[l(t(_),{value:n.contact_address,"onUpdate:value":a[17]||(a[17]=e=>n.contact_address=e),placeholder:"详细地址"},null,8,["value"])]),_:1}),l(t(p),{label:"工作时间"},{default:r(()=>[l(t(_),{value:n.contact_work_time,"onUpdate:value":a[18]||(a[18]=e=>n.contact_work_time=e),placeholder:"如：周一至周五 9:00-18:00"},null,8,["value"])]),_:1}),l(t(p),{label:""},{default:r(()=>[l(t(k),{type:"primary",loading:s.value,onClick:z},{default:r(()=>[...a[26]||(a[26]=[y(" 保存联系方式 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]))}}),aa=Z(K,[["__scopeId","data-v-e64f4e57"]]);export{aa as default};
